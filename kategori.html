/* === CART DATA === */
let cart = [];

/* === TOGGLE SIDEBAR === */
document.getElementById("cart-icon").addEventListener("click", () => {
  document.getElementById("cart-sidebar").classList.toggle("open");
});

/* === ADD TO CART === */
function addToCart(item) {
  const existing = cart.find(i => i.name === item);
  if (existing) {
    existing.qty++;
  } else {
    cart.push({ name: item, qty: 1 });
  }
  updateCart();
}

/* === UPDATE CART DISPLAY === */
function updateCart() {
  const cartItems = document.getElementById("cart-items");
  const cartCount = document.getElementById("cart-count");
  cartItems.innerHTML = "";
  cart.forEach((item, index) => {
    const div = document.createElement("div");
    div.classList.add("cart-item");
    div.innerHTML = `
      <span>${index + 1}. ${item.name}</span>
      <span>x${item.qty}</span>
      <button class="remove-btn" onclick="removeItem(${index})">✖</button>
    `;
    cartItems.appendChild(div);
  });
  cartCount.textContent = cart.length;
}

/* === REMOVE ITEM === */
function removeItem(index) {
  cart.splice(index, 1);
  updateCart();
}

/* === PRINT FUNCTION === */
document.getElementById("print-btn").addEventListener("click", printCart);

function printCart() {
  if (cart.length === 0) {
    alert("Cart masih kosong!");
    return;
  }

  const productName = document.getElementById("productName").value || "-";
  const serialNumber = document.getElementById("serialNumber").value || "-";
  
  let printWindow = window.open("", "_blank");
  let tanggal = new Date();
  let tglCetak = tanggal.toLocaleDateString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric'
  });
  let jamCetak = tanggal.toLocaleTimeString('id-ID');

  let html = `
  <html>
  <head>
    <title>Daftar Sparepart Order</title>
    <style>
      body { font-family: Arial, sans-serif; color: #333; padding: 40px; }
      h2 { text-align: center; color: #6a0dad; margin-bottom: 5px; }
      .info { margin: 15px 0 25px 0; font-size: 14px; }
      table { width: 100%; border-collapse: collapse; margin-top: 10px; }
      th, td { border: 1px solid #6a0dad; padding: 8px; text-align: center; }
      th { background: #6a0dad; color: white; }
      .footer { margin-top: 40px; text-align: center; font-size: 14px; }
      .footer table { width: 100%; margin-top: 20px; }
      .footer td { text-align: center; padding: 20px; }
    </style>
  </head>
  <body>
    <h2>DAFTAR SPAREPART ORDER</h2>
    <div class="info">
      <b>Nama Produk :</b> ${productName}<br>
      <b>Nomor SN :</b> ${serialNumber}
    </div>

    <table>
      <tr>
        <th>No</th>
        <th>Kode</th>
        <th>Nama Sparepart</th>
        <th>Qty</th>
      </tr>
      ${cart.map((item, i) => {
        const kode = item.name.split(" ")[0];
        const nama = item.name.replace(kode + " - ", "");
        return `<tr>
          <td>${i + 1}</td>
          <td>${kode}</td>
          <td>${nama}</td>
          <td>${item.qty}</td>
        </tr>`;
      }).join("")}
    </table>

    <div class="footer">
      <p>Tanggal cetak: ${tglCetak} — Jam: ${jamCetak}</p>
      <p>Dicetak dari sistem internal Verimark</p>

      <table>
        <tr>
          <td>Dibuat oleh<br><br>_________________</td>
          <td>Mengetahui<br><br>_________________</td>
          <td>Menyetujui<br><br>_________________</td>
        </tr>
      </table>
    </div>
  </body>
  </html>`;

  printWindow.document.write(html);
  printWindow.document.close();
  printWindow.print();
}

/* === TAMBAHAN INPUT DI CART SIDEBAR === */
const cartSidebar = document.getElementById("cart-sidebar");
const infoDiv = document.createElement("div");
infoDiv.style.padding = "10px 15px";
infoDiv.innerHTML = `
  <label>Nama Produk:</label><br>
  <input type="text" id="productName" placeholder="Nama produk..." 
         style="width:100%; padding:5px; margin:5px 0 10px; border-radius:5px; border:none;">
  <label>Nomor SN:</label><br>
  <input type="text" id="serialNumber" placeholder="Nomor SN..." 
         style="width:100%; padding:5px; border-radius:5px; border:none;">
`;
cartSidebar.insertBefore(infoDiv, document.getElementById("cart-items"));
